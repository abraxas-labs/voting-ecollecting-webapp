<div class="layout page">
  @if (collection && sheet) {
    <div class="layout-header">
      <bc-sub-navigation-bar
        [type]="'subpage'"
        [border]="false"
        (actionClick)="back()"
      >
        <h4 sub-navigation-title truncateWithTooltip
            tooltip>{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.TITLE' | translate }}</h4>
        @if (collection.collection.userPermissions?.canAddSignatureSheet && sheet.userPermissions?.canEdit) {
          <bc-button
            (buttonClick)="new()"
            variant="tertiary"
            [label]="'COLLECTION.SIGNATURE_SHEETS.DETAIL.NEXT' | translate"
            icon="arrow-right"></bc-button>
        }
        @if (sheet.userPermissions?.canDelete) {
          <bc-button
            (buttonClick)="delete()"
            variant="tertiary"
            [label]="'COLLECTION.SIGNATURE_SHEETS.DETAIL.DELETE' | translate"
            icon="trash"></bc-button>
        }
        <bc-button
          (buttonClick)="back()"
          variant="tertiary"
          [label]="'COLLECTION.SIGNATURE_SHEETS.DETAIL.CLOSE' | translate"
          icon="cancel"></bc-button>
      </bc-sub-navigation-bar>
      <bc-divider [orientation]="'horizontal'"></bc-divider>
      <app-signature-sheet-header>
        <ng-container actions>
          @if (sheet.userPermissions?.canEdit) {
            <bc-icon-button (buttonClick)="edit()"
                            icon="edit"
                            variant="tertiary"></bc-icon-button>
          }
        </ng-container>
      </app-signature-sheet-header>
    </div>

    <div class="layout-content overflow-auto p-4">
      @if (sheet.userPermissions?.canEdit) {
        <div class="info p-3 gap-3 mb-3">
          <p class="whitespace-pre-line">{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.INFO.MAIN' | translate }}</p>
          <p class="whitespace-pre-line">{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.INFO.INVALID' | translate }}</p>
        </div>
        <app-signature-sheet-person-search #personSearch (filter)="search($event)" (searchReset)="reset()"></app-signature-sheet-person-search>
        <p class="mt-3 mb-2">{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.PERSON.FOUND' | translate: { count: personCandidatesPage.totalItemsCount | number } }}</p>
        <vo-ecol-loading-bar [loading]="searching"></vo-ecol-loading-bar>
        <app-signature-sheet-candidates-table
          class="mb-3 block"
          [canAdd]="sheet.count.invalid > 0"
          [candidates]="personCandidatesPage"
          (pageChange)="search(undefined, $event)"
          [loadingRegisterId]="loadingPersonRegisterId"
          (add)="add($event)"></app-signature-sheet-candidates-table>
      } @else {
        <p class="immutable-hint">{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.IMMUTABLE_HINT' | translate }}</p>
      }

      <div class="info p-3 gap-x-4">
        <div>
          <div class="stats gap-x-3 gap-y-1">
            <span>{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.PERSON.COUNT.TOTAL' | translate }}</span>
            <span class="value">{{ sheet.count.total | number }}</span>
            <span>{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.PERSON.COUNT.INVALID' | translate }}</span>
            <span class="value">{{ sheet.count.invalid | number }}</span>
            <span>{{ 'COLLECTION.SIGNATURE_SHEETS.DETAIL.PERSON.COUNT.VALID' | translate }}</span>
            <span class="value">{{ sheet.count.valid | number }}</span>
          </div>
        </div>
        <app-signature-sheet-citizen-table
          class="p-2"
          [canRemove]="sheet.userPermissions?.canEdit ?? false"
          [loading]="loadingCitizens"
          [loadingRegisterId]="loadingPersonRegisterId"
          [citizens]="citizens"
          (remove)="removeCitizen($event)"></app-signature-sheet-citizen-table>
      </div>
    </div>
  }
</div>
